import argparse
import json
import matplotlib.pyplot as plt

parser = argparse.ArgumentParser(prog="parse_results.py",
                                 description="Visualize results from training")
parser.add_argument("-r", "--result", help="path to result json", required=True)
parser.add_argument("-c", "--compare", help="path to compare result", required=False, default='inactive')
parser.add_argument("-m", "--metric", help="the metric to print", required=False, default="accuracy",
                    choices={'accuracy', 'f1score', 'precision', 'recall', 'specificity'})
parser.add_argument("-t", "--training", help="plot training or test results", required=False, default="training",
                    choices=["training", "test"])
arguments = parser.parse_args()


def metrics_to_list(result):
    sub_dic = result['active'][arguments.training]
    metrics = []
    for res in sub_dic:
        metrics.append(sub_dic[res][arguments.metric])
    return metrics


def plot_result():
    result = json.load(open(arguments.result))

    metrics = metrics_to_list(result)

    plt.plot(metrics)
    if arguments.compare == 'inactive':
            plt.axhline(y=result['inactive'][arguments.training][arguments.metric], color='r', linestyle='--')
    else:
        compare = json.load(open(arguments.compare))
        metrics_comp = metrics_to_list(compare)
        plt.plot(metrics_comp, 'r')
    plt.xlabel('Iteration')
    plt.ylabel(arguments.training + ' ' + arguments.metric)
    plt.ylim(0.0, 1.0)
    if len(metrics) < 10:
        plt.xticks(range(len(metrics)))

    ymax = max(metrics)
    ypos_max = metrics.index(ymax)
    ymin = min(metrics)
    ypos_min = metrics.index(ymin)
    plt.annotate(ymax, xy=(ypos_max, ymax), xytext=(ypos_max, ymax+0.1), arrowprops=dict(facecolor='black', arrowstyle='->'))
    plt.annotate(ymin, xy=(ypos_min, ymin), xytext=(ypos_min, ymin-0.1), arrowprops=dict(facecolor='black', arrowstyle='->'))
    plt.savefig(arguments.result.rsplit('.', 1)[0] + '.png')
    plt.show()


if __name__ == '__main__':
    plot_result()
