from sklearn.naive_bayes import MultinomialNB
import numpy, sys
from config import aion_log_file, aion_path
sys.path.insert(0, aion_path)
import Aion
from Aion.conf.config import *

Aion.conf.config.LOG_FILE = aion_log_file
from Aion.utils.misc import specificity_score
from sklearn.metrics import *


def calculateMetrics_multiclass(truth, predicted, average='micro'):
    """
    Calculates and returns a set of metrics from ground truth and predicted vectors
    :param truth: A list of ground truth labels
    :type truth: list
    :param predicted: A list of predicted labels
    :type predicted: list
    :return: A dict of metrics including accuracy, recall, specificity, precision, and F1-score
    """
    # Sanity check
    if not len(truth) == len(predicted):
        print("The two vectors have different dimensionality")
        return {}
    metrics = {}
    # Calculate different mterics
    metrics["accuracy"] = accuracy_score(truth, predicted)
    metrics["recall"] = recall_score(truth, predicted)
    metrics["specificity"] = specificity_score(truth, predicted) # From Aion.utils.misc
    metrics["precision"] = precision_score(truth, predicted, average=average)
    metrics["f1score"] = f1_score(truth, predicted)

    return metrics


def predictAndTestNB(X, y, Xtest=[], ytest=[], alpha=1.0):
    try:
        # Define classifier and cross validation iterator
        clf = MultinomialNB(alpha=alpha)
        # Start the cross validation learning
        X, y, Xtest, ytest = numpy.array(X), numpy.array(y), numpy.array(Xtest), numpy.array(ytest)
        # Fit model
        clf.fit(X, y)
        # Validate and test model
        predicted = clf.predict(X)
        if 1 < len(Xtest) == len(ytest) > 1:
            predicted_test = clf.predict(Xtest)
        else:
            predicted_test = []

    except Exception as e:
        print(e)
        return None, [], []

    return clf, predicted, predicted_test
