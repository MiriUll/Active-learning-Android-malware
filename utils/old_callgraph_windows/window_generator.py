# Basic idea: yield window for each apk or return info for next apk
from networkx import ego_graph
import numpy as np


def next_training_data(apps, feature_generator):
    print('************************\nGenerating features for subgraphs')
    feature_vectors = []
    labels = []
    for app in apps:
        try:
            entry = next(app.entrypoints)
            subgraph = ego_graph(app.graph, entry, radius=3)
            feature_vectors.append(feature_generator.generate_features(subgraph))
            labels.append(app.label)
        except StopIteration:
            # apps with no more call graphs are classified wrong
            pass
    return np.asarray(feature_vectors), np.asarray(labels)
