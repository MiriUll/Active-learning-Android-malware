# Basic idea: yield window for each apk or return info for next apk
from networkx import ego_graph
import numpy as np


class Window_Generator:

    def __init__(self, feature_generator):
        self.feature_generator = feature_generator

    def next_training_data(self, apps):
        print('************************\nGenerating features for subgraphs')
        feature_vectors = []
        labels = []
        for app in apps:
            try:
                entry = next(app.entrypoints)
                subgraph = ego_graph(app.graph, entry, radius=3)
                feature_vectors.append(self.feature_generator.generate_features(subgraph))
                labels.append(app.label)
            except StopIteration:
                # apps with no more call graphs are classified wrong
                pass
        return np.asarray(feature_vectors), np.asarray(labels)
